<div class="caixa-page">
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <h2>Caixa (Registrar Venda)</h2>
    </div>
  </p-toolbar>

  <div class="caixa-grid">

    <div class="col-carrinho">

      <form [formGroup]="formItem" (ngSubmit)="adicionarAoCarrinho()" class="form-add-item">
        <div class="form-field">
          <label for="produto">Produto *</label>
          <p-dropdown
            id="produto"
            [options]="produtosDisponiveis"
            formControlName="produto"
            placeholder="Digite ou selecione o produto"
            [filter]="true" filterBy="label"
            optionLabel="label"
            [style]="{'width': '100%'}"
            [class.ng-invalid]="isFieldInvalid(formItem, 'produto')"
            [class.ng-dirty]="isFieldInvalid(formItem, 'produto')"
          />
        </div>

        <div class="form-field">
          <label for="quantidade">Qtd. *</label>
          <p-inputNumber
            id="quantidade"
            formControlName="quantidade"
            mode="decimal"
            [showButtons]="true"
            [min]="1"
            [class.ng-invalid]="isFieldInvalid(formItem, 'quantidade')"
            [class.ng-dirty]="isFieldInvalid(formItem, 'quantidade')"
          />
        </div>

        <p-button
          icon="pi pi-plus"
          label="Adicionar"
          type="submit"
          [disabled]="formItem.invalid" />
      </form>

      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="error-message" />

      <div class="card-table">
        <p-table [value]="carrinho" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Qtd.</th>
              <th>Preço Unit.</th>
              <th>Subtotal</th>
              <th>Ação</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.nome }}</td>
              <td>{{ item.quantidade }}</td>
              <td>{{ item.precoUnitario | currency:'BRL' }}</td>
              <td>{{ item.subtotal | currency:'BRL' }}</td>
              <td>
                <p-button
                  icon="pi pi-trash"
                  styleClass="p-button-sm p-button-danger"
                  [text]="true"
                  (click)="removerDoCarrinho(item.produtoId)" />
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5">O carrinho está vazio.</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div> <div class="col-pagamento">
    <div class="card-pagamento">
      <h3>Resumo da Venda</h3>

      <div class="total-display">
        <span>TOTAL A PAGAR:</span>
        <span class="valor-total">{{ totalVenda | currency:'BRL' }}</span>
      </div>

      <form [formGroup]="formPagamento" (ngSubmit)="finalizarVenda()">

        <div class="form-field">
          <label for="valorRecebido">Valor Recebido (R$) *</label>
          <p-inputNumber
            id="valorRecebido"
            formControlName="valorRecebido"
            mode="currency"
            currency="BRL"
            locale="pt-BR"
            [minFractionDigits]="2"
            [maxFractionDigits]="2"
            [min]="0"
            [class.ng-invalid]="isFieldInvalid(formPagamento, 'valorRecebido')"
            [class.ng-dirty]="isFieldInvalid(formPagamento, 'valorRecebido')"
          />
        </div>

        <div class="total-display troco-display">
          <span>TROCO:</span>
          <span class="valor-troco">{{ troco | currency:'BRL' }}</span>
        </div>

        <p-button
          label="Finalizar Venda"
          icon="pi pi-check"
          type="submit"
          styleClass="p-button-success"
          [disabled]="carrinho.length === 0 || formPagamento.invalid" />
      </form>
    </div>
  </div> </div> </div>
